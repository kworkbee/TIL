<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>멀티 스레드 환경에서의 동시성 보장 | Today I Learned</title><meta name="description" content="Tommy's Today I Learned">
    <link rel="modulepreload" href="/TIL/assets/app.afe75d95.js"><link rel="modulepreload" href="/TIL/assets/guaranteeing-concurrency-in-multi-threaded-environment.html.232a698f.js"><link rel="modulepreload" href="/TIL/assets/guaranteeing-concurrency-in-multi-threaded-environment.html.4e75b6b0.js"><link rel="prefetch" href="/TIL/assets/index.html.4126a320.js"><link rel="prefetch" href="/TIL/assets/Graph.html.1b406419.js"><link rel="prefetch" href="/TIL/assets/HashTable-Collision-Solving.html.2e9d9a93.js"><link rel="prefetch" href="/TIL/assets/Functional-Programming.html.a3fffd85.js"><link rel="prefetch" href="/TIL/assets/OOP.html.a82e2750.js"><link rel="prefetch" href="/TIL/assets/SQL.html.f003270f.js"><link rel="prefetch" href="/TIL/assets/CI-CD.html.a835f439.js"><link rel="prefetch" href="/TIL/assets/Deployment-History.html.19cf4ee8.js"><link rel="prefetch" href="/TIL/assets/Deployment-Strategies.html.be3a896c.js"><link rel="prefetch" href="/TIL/assets/Docker-Network-Structure.html.577edd54.js"><link rel="prefetch" href="/TIL/assets/Docker.html.b336faac.js"><link rel="prefetch" href="/TIL/assets/Multi-Tier-Architecture.html.f47aea02.js"><link rel="prefetch" href="/TIL/assets/TIL-with-Github-Actions.html.3482114d.js"><link rel="prefetch" href="/TIL/assets/Major-Commands.html.b0934ada.js"><link rel="prefetch" href="/TIL/assets/Arrays-asList-List-of.html.ad5dfd74.js"><link rel="prefetch" href="/TIL/assets/JVM-Java-Application-Performance-And-Memory-Management.html.928bc366.js"><link rel="prefetch" href="/TIL/assets/equals-hashcode.html.2042008d.js"><link rel="prefetch" href="/TIL/assets/Law-of-Demeter.html.97d04cb5.js"><link rel="prefetch" href="/TIL/assets/JUnit-Assertions-and-Assumptions.html.819aa328.js"><link rel="prefetch" href="/TIL/assets/JUnit.html.62da129d.js"><link rel="prefetch" href="/TIL/assets/Overview.html.0c0ac864.js"><link rel="prefetch" href="/TIL/assets/Bean.html.20590361.js"><link rel="prefetch" href="/TIL/assets/Filter-Interceptor.html.f7291695.js"><link rel="prefetch" href="/TIL/assets/Adapter.html.f39f9345.js"><link rel="prefetch" href="/TIL/assets/Singleton.html.65c1f8bb.js"><link rel="prefetch" href="/TIL/assets/01.html.5e45056b.js"><link rel="prefetch" href="/TIL/assets/02.html.19583e54.js"><link rel="prefetch" href="/TIL/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/TIL/assets/index.html.717b7c4d.js"><link rel="prefetch" href="/TIL/assets/Graph.html.f3cb433b.js"><link rel="prefetch" href="/TIL/assets/HashTable-Collision-Solving.html.1ef1cafd.js"><link rel="prefetch" href="/TIL/assets/Functional-Programming.html.f3dbc456.js"><link rel="prefetch" href="/TIL/assets/OOP.html.2cea3868.js"><link rel="prefetch" href="/TIL/assets/SQL.html.ff1db379.js"><link rel="prefetch" href="/TIL/assets/CI-CD.html.f8af372c.js"><link rel="prefetch" href="/TIL/assets/Deployment-History.html.653f4e47.js"><link rel="prefetch" href="/TIL/assets/Deployment-Strategies.html.4a3d98d2.js"><link rel="prefetch" href="/TIL/assets/Docker-Network-Structure.html.63ddceb2.js"><link rel="prefetch" href="/TIL/assets/Docker.html.4a690bb3.js"><link rel="prefetch" href="/TIL/assets/Multi-Tier-Architecture.html.f92abaa8.js"><link rel="prefetch" href="/TIL/assets/TIL-with-Github-Actions.html.35f1d19f.js"><link rel="prefetch" href="/TIL/assets/Major-Commands.html.50e66fdd.js"><link rel="prefetch" href="/TIL/assets/Arrays-asList-List-of.html.a5d279ef.js"><link rel="prefetch" href="/TIL/assets/JVM-Java-Application-Performance-And-Memory-Management.html.a4158690.js"><link rel="prefetch" href="/TIL/assets/equals-hashcode.html.b32fdf75.js"><link rel="prefetch" href="/TIL/assets/Law-of-Demeter.html.8d14d328.js"><link rel="prefetch" href="/TIL/assets/JUnit-Assertions-and-Assumptions.html.0756e2e0.js"><link rel="prefetch" href="/TIL/assets/JUnit.html.24aef4be.js"><link rel="prefetch" href="/TIL/assets/Overview.html.8be82c2c.js"><link rel="prefetch" href="/TIL/assets/Bean.html.26e208dc.js"><link rel="prefetch" href="/TIL/assets/Filter-Interceptor.html.cb0f79fb.js"><link rel="prefetch" href="/TIL/assets/Adapter.html.e7c5387f.js"><link rel="prefetch" href="/TIL/assets/Singleton.html.54c11b73.js"><link rel="prefetch" href="/TIL/assets/01.html.dae2f217.js"><link rel="prefetch" href="/TIL/assets/02.html.33852bf7.js"><link rel="prefetch" href="/TIL/assets/404.html.534e1385.js"><link rel="prefetch" href="/TIL/assets/404.a4949e91.js"><link rel="prefetch" href="/TIL/assets/Layout.693224d9.js">
    <link rel="stylesheet" href="/TIL/assets/style.8219ecdf.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/TIL/" class=""><!----><span class="site-name">Today I Learned</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://about.g1tommy.me/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://about.g1tommy.me/resume" rel="noopener noreferrer" target="_blank" aria-label="Profile"><!--[--><!--]--> Profile <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/kworkbee/TIL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://about.g1tommy.me/" rel="noopener noreferrer" target="_blank" aria-label="Blog"><!--[--><!--]--> Blog <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://about.g1tommy.me/resume" rel="noopener noreferrer" target="_blank" aria-label="Profile"><!--[--><!--]--> Profile <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/kworkbee/TIL" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">CS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/CS/OOP.html" class="sidebar-item" aria-label="OOP"><!--[--><!--]--> OOP <!--[--><!--]--></a><!----></li><li><a href="/TIL/CS/Functional-Programming.html" class="sidebar-item" aria-label="함수형 프로그래밍"><!--[--><!--]--> 함수형 프로그래밍 <!--[--><!--]--></a><!----></li><li><a href="/TIL/CS/Design-Pattern/Singleton.html" class="sidebar-item" aria-label="[Design Pattern] Singleton"><!--[--><!--]--> [Design Pattern] Singleton <!--[--><!--]--></a><!----></li><li><a href="/TIL/CS/Design-Pattern/Adapter.html" class="sidebar-item" aria-label="[Design Pattern] Adapter"><!--[--><!--]--> [Design Pattern] Adapter <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Java <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Java/Effective-Java/01.html" class="sidebar-item" aria-label="생성자 대신 정적 팩터리 메서드를 고려하라"><!--[--><!--]--> 생성자 대신 정적 팩터리 메서드를 고려하라 <!--[--><!--]--></a><!----></li><li><a href="/TIL/Java/Effective-Java/02.html" class="sidebar-item" aria-label="생성자에 매개변수가 많다면 빌더를 고려하라"><!--[--><!--]--> 생성자에 매개변수가 많다면 빌더를 고려하라 <!--[--><!--]--></a><!----></li><li><a href="/TIL/Java/Arrays-asList-List-of.html" class="sidebar-item" aria-label="Arrays.asList vs. List.of"><!--[--><!--]--> Arrays.asList vs. List.of <!--[--><!--]--></a><!----></li><li><a href="/TIL/Java/JVM-Java-Application-Performance-And-Memory-Management.html" class="sidebar-item" aria-label="Java Application Performance &amp; Memory Management"><!--[--><!--]--> Java Application Performance &amp; Memory Management <!--[--><!--]--></a><!----></li><li><a href="/TIL/Java/equals-hashcode.html" class="sidebar-item" aria-label="equals And hashCode"><!--[--><!--]--> equals And hashCode <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/TIL/Java/guaranteeing-concurrency-in-multi-threaded-environment.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="멀티 스레드 환경에서의 동시성 보장"><!--[--><!--]--> 멀티 스레드 환경에서의 동시성 보장 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/TIL/Java/guaranteeing-concurrency-in-multi-threaded-environment.html#가시성" class="router-link-active router-link-exact-active sidebar-item" aria-label="가시성"><!--[--><!--]--> 가시성 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/TIL/Java/guaranteeing-concurrency-in-multi-threaded-environment.html#동시-접근" class="router-link-active router-link-exact-active sidebar-item" aria-label="동시 접근"><!--[--><!--]--> 동시 접근 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/TIL/Java/guaranteeing-concurrency-in-multi-threaded-environment.html#동시성-보장-방법" class="router-link-active router-link-exact-active sidebar-item" aria-label="동시성 보장 방법"><!--[--><!--]--> 동시성 보장 방법 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Algorithm <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Algorithm/Graph.html" class="sidebar-item" aria-label="Graph"><!--[--><!--]--> Graph <!--[--><!--]--></a><!----></li><li><a href="/TIL/Algorithm/HashTable-Collision-Solving.html" class="sidebar-item" aria-label="HashTable Collision 해결"><!--[--><!--]--> HashTable Collision 해결 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Backend <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Backend/Spring/Bean.html" class="sidebar-item" aria-label="[Spring] Bean"><!--[--><!--]--> [Spring] Bean <!--[--><!--]--></a><!----></li><li><a href="/TIL/Backend/Spring/Filter-Interceptor.html" class="sidebar-item" aria-label="[Spring] Filter &amp; Interceptor"><!--[--><!--]--> [Spring] Filter &amp; Interceptor <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">DevOps <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/DevOps/TIL-with-Github-Actions.html" class="sidebar-item" aria-label="TIL with Github Actions"><!--[--><!--]--> TIL with Github Actions <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/CI-CD.html" class="sidebar-item" aria-label="CI / CD"><!--[--><!--]--> CI / CD <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/Multi-Tier-Architecture.html" class="sidebar-item" aria-label="Multi-Tier Architecture"><!--[--><!--]--> Multi-Tier Architecture <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/Deployment-History.html" class="sidebar-item" aria-label="컨테이너 기술의 발전"><!--[--><!--]--> 컨테이너 기술의 발전 <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/Deployment-Strategies.html" class="sidebar-item" aria-label="배포 전략"><!--[--><!--]--> 배포 전략 <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/Docker.html" class="sidebar-item" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a><!----></li><li><a href="/TIL/DevOps/Docker-Network-Structure.html" class="sidebar-item" aria-label="도커 네트워크 구조"><!--[--><!--]--> 도커 네트워크 구조 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">TDD <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/TDD/Overview.html" class="sidebar-item" aria-label="TDD Overview"><!--[--><!--]--> TDD Overview <!--[--><!--]--></a><!----></li><li><a href="/TIL/TDD/JUnit.html" class="sidebar-item" aria-label="JUnit"><!--[--><!--]--> JUnit <!--[--><!--]--></a><!----></li><li><a href="/TIL/TDD/JUnit-Assertions-and-Assumptions.html" class="sidebar-item" aria-label="JUnit5 Assertions &amp; Assumptions"><!--[--><!--]--> JUnit5 Assertions &amp; Assumptions <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Database <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Database/SQL.html" class="sidebar-item" aria-label="SQL"><!--[--><!--]--> SQL <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Git <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Git/Major-Commands.html" class="sidebar-item" aria-label="Git Major Commands"><!--[--><!--]--> Git Major Commands <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Refactoring <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/TIL/Refactoring/Law-of-Demeter.html" class="sidebar-item" aria-label="Law of Demeter"><!--[--><!--]--> Law of Demeter <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="멀티-스레드-환경에서의-동시성-보장" tabindex="-1"><a class="header-anchor" href="#멀티-스레드-환경에서의-동시성-보장" aria-hidden="true">#</a> 멀티 스레드 환경에서의 동시성 보장</h1><p>자바 메모리 구조는 CPU - RAM 아키텍처 기반으로 다음과 같이 동작합니다.</p><p><img src="/TIL/assets/image.8cc3c02b.png" alt="CPU-RAM"></p><ul><li>CPU가 작업 처리를 위해 필요한 데이터를 RAM에서 읽어 CPU Cache에 복제</li><li>작업 처리 후 변경된 CPU Cache 데이터를 RAM에 overwrite</li></ul><p>CPU가 여러 개인 경우 CPU별로 Cache에 저장된 데이터가 달라 문제가 발생할 수 있습니다.</p><h2 id="가시성" tabindex="-1"><a class="header-anchor" href="#가시성" aria-hidden="true">#</a> 가시성</h2><ul><li>하나의 스레드에서 공유 자원 (변수 / 객체 등)을 수정한 결과가 다른 스레드에게 보이지 않을 경우 발생</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> stopRequested<span class="token punctuation">;</span> 

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">!</span>stopRequested <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Ended Background Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        background<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (A)</span>

        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// (B)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Ended Main Thread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>백그라운드 스레드는 메인 스레드와 다른 CPU 캐시에 stopRequested 리소스를 복제하고, 이후 복제한 값을 사용해 조건식을 반복해서 실행합니다. 1초 이후 메인 스레드에서 boolean 값을 변경하지만 다른 CPU 캐시를 참조하므로 메인 스레드에서 일어난 변경을 알아채지 못합니다. 따라서 메인 스레드는 종료되어도 백그라운드 스레드는 alive 합니다.</p><h2 id="동시-접근" tabindex="-1"><a class="header-anchor" href="#동시-접근" aria-hidden="true">#</a> 동시 접근</h2><ul><li>여러 스레드에서 공유 자원을 동시에 접근했을 때 연산이 가장 늦게 끝난 결과값으로 overwrite되는 문제</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> t<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>코드 상으로 보았을 때 1 ~ 100 * 1000만큼 순차적으로 출력할 것처럼 보여지지만, 여러 스레드에서 공유자원에 접근해 값을 바꾸므로 순서 보장이 되지 않아 의도와 다른 결과가 출력됩니다.</p><h2 id="동시성-보장-방법" tabindex="-1"><a class="header-anchor" href="#동시성-보장-방법" aria-hidden="true">#</a> 동시성 보장 방법</h2><ul><li><code>volatile</code> keyword <ul><li>가시성 문제는 해결되지만, 동시 접근 문제는 여전히 존재합니다.</li><li>해당 키워드가 붙은 리소스는 Read와 Write를 CPU Cache가 아닌 메인 메모리에서 동작, 즉 자원을 저장하는 메모리가 하나가 되기 때문에 같은 공유 자원에 대해 메모리별로 다른 값을 가지는 경우는 없습니다.</li><li>여러 스레드에서 메인 메모리의 공유 자원에 동시 접근 가능하기 때문에 여러 스레드에서 값을 수정하려고 시도하면 값이 overwrite 될 수 있어 동시 접근 문제 해결이 불가합니다.</li></ul></li><li><code>synchronized</code> keyword <ul><li>안전하게 동시성 보장이 가능하지만 가장 비용이 비쌉니다.</li></ul></li><li><code>AtomicReference&lt;V&gt;</code> class <ul><li>compare-and-swap 알고리즘을 사용하여 가장 저렴한 비용으로 동시성을 보장합니다.</li><li>현재 스레드가 존재하는 CPU 캐시와 메인 메모리 저장 값을 비교해 일치하는 경우 새로운 값으로 교체하고, 그렇지 않을 경우 기존 교체가 실패되어 Retry하는 방식입니다.</li><li>CPU가 메인 메모리 리소스를 CPU 캐시로 가져와 연산을 수행하는 동안 다른 스레드에서 연산이 수행돼, 메인 메모리 자원 값이 변경될 경우 기존 연산을 실패 처리하고, 새로 바뀐 메인 메모리 값으로 재수행합니다.</li></ul></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> atomic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;atomic : &quot;</span> <span class="token operator">+</span> atomic<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>									<span class="token comment">// null</span>

<span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> atomic2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;atomic2 : &quot;</span> <span class="token operator">+</span> atomic2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">// 100</span>

<span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> atomic3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Value before setting : &quot;</span> <span class="token operator">+</span> atomic3<span class="token punctuation">.</span><span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 10</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Value after setting : &quot;</span> <span class="token operator">+</span> atomic3<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">// 20</span>

<span class="token keyword">int</span> expected <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> atomic4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Success ? &quot;</span> <span class="token operator">+</span> atomic4<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// false</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Value : &quot;</span> <span class="token operator">+</span> atmoic4<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>														<span class="token comment">// 10</span>

atomic4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Success ? &quot;</span> <span class="token operator">+</span> atomic4<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// true</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Value : &quot;</span> <span class="token operator">+</span> atmoic4<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>														<span class="token comment">// 100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/kworkbee/TIL/edit/main/docs/Java/guaranteeing-concurrency-in-multi-threaded-environment.md" rel="noopener noreferrer" target="_blank" aria-label="Edit"><!--[--><!--]--> Edit <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/TIL/Java/equals-hashcode.html" class="" aria-label="equals And hashCode"><!--[--><!--]--> equals And hashCode <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/TIL/assets/app.afe75d95.js" defer></script>
  </body>
</html>
